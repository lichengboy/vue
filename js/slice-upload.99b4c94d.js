(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["slice-upload"],{"0d5e":function(e,t,a){"use strict";var s=a("bc3a"),r=a.n(s),n=a("5c96");let o,c={isLoading:!0},i=0;const l=r.a.create({baseURL:Object({NODE_ENV:"production",BASE_URL:""}).VUE_APP_BASE_URL,timeout:5e4,withCredentials:!0});l.interceptors.request.use(e=>(e={...c,...e},e.headers["Content-Type"]="application/json",i++,1===i&&e.isLoading&&(o=n["Loading"].service({lock:!0,text:"Loading",target:document.querySelector(".el-main"),spinner:"el-icon-loading",background:"rgba(255, 255, 255, 0.7)"})),e),e=>Promise.reject(e)),l.interceptors.response.use(e=>{if(i--,0===i&&o&&o.close(),!e.config.responseType){const{result:t,msg:a}=e.data;return t?e.data:(n["Message"].error(a),Promise.reject(e.data))}return e.data},e=>{let t="";if(e&&e.response)switch(e.response.status){case 302:t="接口重定向了！";break;case 401:t="您未登录，或者登录已经超时，请先登录！";break;case 403:t="您没有权限操作！";break;case 404:t="请求地址出错: "+e.response.config.url;break;case 500:t="服务器内部错误！";break;case 501:t="服务未实现！";break;case 502:t="网关错误！";break;case 503:t="服务不可用！";break;case 504:t="服务暂时无法访问，请稍后再试！";break;case 505:t="HTTP版本不受支持！";break;default:t="异常问题，请联系管理员！";break}else t=e.message.includes("timeout")?"请求超时":"异常问题，请联系管理员！";return i--,o.close(),n["Message"].error(t),Promise.reject(e)}),t["a"]=l},"7fe1":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("el-upload",e._g(e._b({attrs:{data:{isType:1,need:2},action:"action","http-request":e.uploadFile}},"el-upload",e.$attrs,!1),e.$listeners),[t("el-button",{attrs:{icon:"el-icon-upload2"}})],1)},r=[],n=(a("14d9"),a("0d5e"));const o=(e,t,a={})=>new Promise((s,r)=>{Object(n["a"])({url:e,method:"post",data:t,headers:{...a,"Content-Type":"multipart/form-data"}}).then(e=>s(e.data)).catch(e=>r(e))}),c=async(e,t)=>{console.log(t,"file");const a=5242880,s=Math.ceil(t.file.size/a),r=(e,t)=>{let s=t*a,r=Math.min(e.file.size,s+a),n=e.file.slice(s,r);return{start:s,end:r,chunk:n}},o=t=>new Promise((a,s)=>{Object(n["a"])({url:e,method:"post",data:t,headers:{"Content-Type":"multipart/form-data"}}).then(e=>a(e.data)).catch(e=>s(e))}),c=e=>{const{chunk:a}=r(t,e);let n=new FormData;return n.append("file",a),n.append("index",e),n.append("chunkCount",s),o(n)},i=[];try{for(let t=0;t<s;++t)i.push(c(t));const e=await Promise.all(i);return e}catch(l){return l}};var i=a("5c96"),l={methods:{async uploadFile({data:e,file:t}){let a="/files/upload",s=5242880,r=i["Loading"].service({text:"正在上传文件，请稍后..."});try{if(t.size<s){console.log("直接上传");let s=new FormData;for(let t in e)s.append(t,e[t]);s.append("file",t);const n=await o(a,s);return r.close(),n}{console.log("分片上传"),e.file=t;const s=await c(a,e);return r.close(),s}}catch(n){return r.close(),n}}}},u=l,d=a("2877"),p=Object(d["a"])(u,s,r,!1,null,null,null);t["default"]=p.exports}}]);
//# sourceMappingURL=slice-upload.99b4c94d.js.map